<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalle de Direccion</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <main class="layout">
      <nav class="top-nav">
        {% for item in nav_items %}
        <a class="nav-link {% if current_view == item.key %}active{% endif %}" href="{{ item.href }}">{{ item.label }}</a>
        {% endfor %}
        <span class="nav-user">Sesion: {{ current_user.user }} ({{ current_user.role }})</span>
        <form method="post" action="/logout">
          <button type="submit" class="nav-logout">Salir</button>
        </form>
      </nav>
      <header class="hero">
        <p class="eyebrow">Detalle de Cuenta</p>
        <h1>{{ name }}</h1>
        <p class="lead">
          Credito: <strong>{{ credito }}</strong><br />
          Direccion: <span class="mono">{{ address }}</span><br />
          Balance ALGO: <strong>{{ "%.6f"|format(algo_balance) }}</strong>
        </p>
        <p><a class="refresh" href="/">Volver al dashboard</a></p>
        {% if message %}
        <p class="msg ok">{{ message }}</p>
        {% endif %}
        {% if error %}
        <p class="msg err">{{ error }}</p>
        {% endif %}
      </header>

      {% if can_transact %}
      <section class="panel">
        <div class="panel-top">
          <h2>Enviar ALGO a esta direccion</h2>
        </div>
        <p class="lead">
          Origen: <strong>{{ sender_name }}</strong><br />
          Cuenta origen: <span class="mono">{{ sender_address }}</span><br />
          Disponible: <strong>{{ "%.6f"|format(sender_algo_balance) }} ALGO</strong>
        </p>

        <form method="post" action="/send-algo" class="send-form">
          <input type="hidden" name="destination" value="{{ address }}" />

          <label>
            Cantidad ALGO
            <input type="number" step="any" name="amount" min="0.000001" required value="0.1" />
          </label>

          <label>
            Mnemonic (opcional)
            <textarea
              name="mnemonic_override"
              rows="3"
              placeholder="Si lo dejas vacio, usa seed.txt descifrado con LISTA_PASSWORD"
            ></textarea>
          </label>

          <button type="submit" class="refresh">Enviar ALGO</button>
        </form>
      </section>

      <section class="panel">
        <div class="panel-top">
          <h2>Enviar ASA a esta direccion</h2>
        </div>
        <p class="lead">
          Origen: <strong>{{ sender_name }}</strong><br />
          Cuenta origen: <span class="mono">{{ sender_address }}</span>
        </p>

        <form method="post" action="/send-asa" class="send-form">
          <input type="hidden" name="destination" value="{{ address }}" />

          <label>
            Asset ID
            <select name="asset_id" required>
              {% for option in send_asset_options %}
              <option value="{{ option.asset_id }}" {% if selected_asset == (option.asset_id|string) %}selected{% endif %}>
                {{ option.label }} | disponible: {{ option.available_human }} (base: {{ option.available }})
              </option>
              {% endfor %}
            </select>
          </label>

          <label>
            Cantidad (unidad humana del token)
            <input type="number" step="any" name="amount" min="0.00000001" required value="1" />
          </label>

          <label>
            Mnemonic (opcional)
            <textarea
              name="mnemonic_override"
              rows="3"
              placeholder="Si lo dejas vacio, usa seed.txt descifrado con LISTA_PASSWORD"
            ></textarea>
          </label>

          <button type="submit" class="refresh">Enviar ASA</button>
        </form>
      </section>

      <section class="panel">
        <div class="panel-top">
          <h2>Opt-in ASA en otra cuenta</h2>
        </div>
        <p class="lead">
          Hace opt-in en la misma cuenta emisora (seed actual) para poder recibir este token.
          Esa cuenta debe tener ALGO suficiente para la transaccion y minimo de reserva.
        </p>

        <form method="post" action="/optin-asa" class="send-form">
          <input type="hidden" name="owner_address" value="{{ address }}" />

          <label>
            Asset ID
            <select name="asset_id" required>
              {% for option in send_asset_options %}
              <option value="{{ option.asset_id }}">{{ option.label }}</option>
              {% endfor %}
            </select>
          </label>

          <button type="submit" class="refresh">Hacer Opt-in</button>
        </form>
      </section>
      {% else %}
      <section class="panel">
        <div class="panel-top">
          <h2>Permisos</h2>
        </div>
        <p class="lead">Esta cuenta no tiene seed de 25 palabras asociada. Envio y opt-in ocultos.</p>
        {% if sender_block_reason %}
        <p class="msg err">{{ sender_block_reason }}</p>
        {% endif %}
      </section>
      {% endif %}

      <section class="panel">
        <div class="panel-top">
          <h2>Tokens de la cuenta</h2>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Asset ID</th>
                <th>Alias</th>
                <th>Nombre</th>
                <th>Ticker</th>
                <th>Decimales</th>
                <th>Cantidad (humana)</th>
                <th>Frozen</th>
                <th>Accion</th>
              </tr>
            </thead>
            <tbody>
              {% for item in assets %}
              <tr>
                <td>{{ item.asset_id }}</td>
                <td>{{ item.alias if item.alias else "-" }}</td>
                <td>{{ item.name if item.name else "-" }}</td>
                <td>{{ item.unit_name if item.unit_name else "-" }}</td>
                <td>{{ item.decimals if item.decimals is not none else "-" }}</td>
                <td>{{ item.amount_human }}</td>
                <td>{{ "si" if item.is_frozen else "no" }}</td>
                <td>
                  <a class="refresh" href="/address/{{ address }}?asset_id={{ item.asset_id }}">Usar en envio</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </body>
</html>
